function showCharLines(){$("h5").removeClass(),$(".sortDiv").each(function(){var e=0;$(this).find(".lines").each(function(){e+=parseInt($(this).html())}),$(this).find("h4").html(e+" Lines");var t=Math.round(e/totalLines*1e4)/100+"%";e>totalLines/readers*1.25?$(this).find("h5").html(t).addClass("positive"):totalLines/readers*.75>e?$(this).find("h5").html(t).addClass("negative"):$(this).find("h5").html(t)})}function updateRoles(){roles=new Array;var e=0;$(".connectedSortable").each(function(){var t=0;roles[e]=new Array,$(this).find("li").each(function(){roles[e][t]=$(this).attr("id"),t++}),e++})}function checkConflicts(){for($("li").removeClass("roleConflict"),i=0;i<roles.length;i++)for(j=0;j<roles[i].length;j++){var e=roles[i][j];for(k=0;k<roles[i].length;k++){var t=roles[i][k];e!=t&&conversations[e][t]>0&&($(".connectedSortable").eq(i).children("li").eq(j).addClass("roleConflict"),$(".connectedSortable").eq(i).children("li").eq(k).addClass("roleConflict"))}}}function updateReaderNames(){$(".sortDiv li").each(function(){var e=$(this).parent().parent().find(".renameReader").val();$("h4."+$(this).attr("id")).find(".reader").html("("+e+")")})}function addHighlighting(){var e=0;$(".sortDiv").each(function(){var t=!1;$(this).find(".highlightInput").is(":checked")&&(t=!0),$(this).find("li").each(function(){$("."+$(this).attr("id")).removeAttr("style"),t&&$("."+$(this).attr("id")).css("background-color",highlightColors[e%highlightColors.length])}),t&&e++})}var highlightColors=["#ffc","#ccf","#fcc","#cff","#fcf","#cfc"];$(document).ready(function(){$(".connectedSortable li").click(function(){if($(this).hasClass("active"))$(".connectedSortable li").removeClass("conflict active").find(".conflicts").html("&nbsp;");else{$(".connectedSortable li").removeClass("conflict active").find(".conflicts").html("&nbsp;"),$(this).addClass("active");var e=$(this).attr("id");$(".connectedSortable li").each(function(){if($(this).attr("id")){var t=$(this).attr("id");e!=t&&(1==conversations[e][t]?$(this).addClass("conflict").find(".conflicts").html(conversations[e][t]+" conversation"):conversations[e][t]>0&&$(this).addClass("conflict").find(".conflicts").html(conversations[e][t]+" conversations"))}})}}),$(".connectedSortable").sortable({connectWith:".connectedSortable",deactivate:function(){updateRoles(),checkConflicts(),showCharLines()},placeholder:"ui-state-highlight"}).disableSelection(),showCharLines(),$(document).on("click",".addReader",function(){readers++,$(".sortDiv").last().children("ul").hasClass("reader")?($(".sortWrapper").append('<div class="sortDiv"><span><h3>Reader '+readers+'</h3><input name="reader" type="text" class="renameReader" value="Reader '+readers+'"></span><h4>0 lines</h4><h5>0%</h5><ul id="reader'+readers+'" class="connectedSortable reader"></ul></div>'),$(".connectedSortable").sortable({connectWith:".connectedSortable",deactivate:function(){updateRoles(),checkConflicts(),showCharLines()},placeholder:"ui-state-highlight"}).disableSelection()):($(".sortDiv").last().find("h3").html("Reader "+readers),$(".sortDiv").last().children("ul").addClass("reader")),$("h2").html("Roles - "+readers+" Readers"),showCharLines()}),$(document).on("change",".characters input",function(){var e=0;$(".characters input").each(function(){$("."+$(this).val()).removeAttr("style"),$(this).prop("checked")&&($("."+$(this).val()).css({"background-color":highlightColors[e%highlightColors.length]}),e++)})}),$(document).on("click",".showHideCharacters",function(){$(".charactersWrapper").toggleClass("showCharacters")}),$(document).on("click",".characters label",function(){$(this).siblings("input").trigger("click")}),$(document).on("click",".showSort",function(){updateReaderNames(),addHighlighting(),$(".sortSection").toggle()}),$(".sortWrapper").on("click","span h3",function(){$(this).hide(),$(this).siblings(".renameReader").show().focus().select()}),$(".sortWrapper").on("focusout",".renameReader",function(){$(".sortDiv span h3").each(function(){$(this).html($(this).siblings(".renameReader").val())}),$(".sortDiv span .renameReader").hide(),$(".sortDiv span h3").show()}),$(".sortWrapper").on("keypress",".renameReader",function(e){13==e.keyCode&&$(this).trigger("focusout")}),$(document).on("scroll",function(){var e=Math.round(window.scrollY/$(document).height()*1e4)/100+"%";$(".completed").width(e),$(".percentText").html(e)}),updateReaderNames()});